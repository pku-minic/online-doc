# 实验说明

## 概述

在编译原理课程实践中, 大家需要开发一个将 SysY 语言编译到 RISC-V 汇编的编译器. 当然, 这一步跨得有些太大了, 所以我们把它分成了两个步骤:

1. 将 SysY 语言编译到 Koopa IR.
2. 将 Koopa IR 生成到 RISC-V 汇编.

Koopa IR 是我们为编译原理课程实践设计的一种中间表示 (IR, intermediate representation). 相比于之前编译实践课采用的 IR, Koopa IR 在设计上更为合理. 它在形式上类似于 LLVM IR, 但简化了相当多的内容, 只专注于实践需要的部分.

与此同时, 我们为 Koopa IR 设计了[配套的运行时库](https://github.com/pku-minic/koopa), 你的编译器可以借助这套运行时库轻松地解析/生成/修改/输出 Koopa IR, 你完全不需要对其他无用的细节做过多考虑.

## 提交代码

我们设置了[在线评测系统 (OJ)](https://course.educg.net) 来评测大家完成的编译器. 开发完毕后, 你应该将自己的代码上传到 Git 仓库 (OJ 自带了一个 [GitLab](https://gitlab.eduxiji.net)), OJ 会拉取仓库中的代码, 并使用你的编译器编译各类测试用例, 根据编译后测试用例的执行结果来判断你的编译器功能是否正常, 据此确定你实践部分的成绩.

考虑到实际情况:

1. 有些大佬/巨佬/超佬/神不满足于我们提供的 IR, 他们决定自己完成从 SysY 到 RISC-V 中包括 IR 设计的全部内容, 甚至在编译代码的过程中还对代码进行了优化.
2. 而有些不那么大佬的同学已经把 C/C++ 忘得差不多了, 他们即便是按照我们划分后的步骤去完成实验, 也觉得十分吃力.

对于第一点, 我们的评测系统会设置以下提交入口:

* **SysY 到 Koopa:** 评测机会把 SysY 代码喂给你的编译器, 并期待你的编译器输出 Koopa IR. 评测机会检查输出的正确性.
* **SysY 到 RISC-V:** 同上, 但输入和输出分别是 SysY 和 RISC-V 汇编. 不管你的编译器用什么 IR, 只要输出了正确的汇编, 就可以通过评测.
* **性能测试:** 输入和输出分别是 SysY 和 RISC-V 汇编, 评测机不仅会检查输出的正确性, 还会记录输出程序的执行时间, 得到性能数据, 同时设置一个性能排行榜 ~~(直接开卷)~~.

文档的后续章节将进一步介绍在线评测系统的细节.

对于第二点, 我们的文档在内容组织上做了诸多考虑.

## 文档的内容组织

这篇在线文档会按照 SysY 到 Koopa IR 再到 RISC-V 汇编的思路, 将两个步骤进一步细分为十个阶段, 引导大家从零开始, 由易到难, 逐步且增量地构建一个真正的编译器:

* **Lv0 - Lv2:** 熟悉实验环境和框架, 构建一个只能处理 `main` 函数和 `return` 的简易编译器.
* **Lv3:** 为你的编译器添加处理表达式的功能 (加减乘除模/比较运算/逻辑运算).
* **Lv4:** 为你的编译器添加处理变量/常量的功能.
* **Lv5:** 为你的编译器添加处理语句块的功能, 也就是用 `{` 和 `}` 包裹起来的一系列语句, 同时引入作用域的概念.
* **Lv6 - Lv7:** 为你的编译器添加处理 `if` 语句和 `while` 语句的功能, 此时你的编译器已经可以处理程序中所有的控制流了.
* **Lv8:** 为你的编译器添加处理函数和全局变量的功能.
* **Lv9:** 为你的编译器添加处理函数和数组的功能, 此时你的编译器已经可以方便地写出大部分实用程序了.

当然, 如果你学有余力, 我们还在 **Lv9+** 阶段准备了更多可选内容:

* **Lv9+.1:** 让你的编译器能够编译一些更复杂, 但更有趣的程序.
* **Lv9+.2 - Lv9+.4:** 让你的编译器支持寄存器分配, 优化等高级功能, 并进行性能测试.
* **Lv9+.5:** 一些和 SysY 语言无关的, 全新的编译方向的课题.

完成可选内容可以获得加分.

## 评分规则

?> **TODO:** 待补充

## 截止时间

?> **TODO:** 待补充

## 学术诚信

!> 学术诚信远比课程实践本身重要.

开始课程实践前, 我们需要明确以下原则:

* **严禁**抄袭/拷贝其他同学的代码/报告.
* **严禁**将自己的代码/报告提供给他人.
* **允许**参考相关的开源实现, 但你必须在报告中声明参考的内容. **严禁**照搬开源实现.

我们会对同学们提交的代码/报告进行查重, 同时接受同学们的举报. 若发现雷同现象, 无论你是提供者还是参考者, **均会受到同等处罚**.

对于雷同现象严重者, 课程组在调查后有权将情况上报至教务, 并按相关规定进行进一步的严肃处理.
